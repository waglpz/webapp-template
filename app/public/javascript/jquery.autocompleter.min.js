/**
* jquery-autocompleter v0.3.0 - 2020-01-04
* Easy customisable and with localStorage cache support.
* http://github.com/fitiskin/jquery-autocompleter
*
* @license (c) 2020 Artem Fitiskin MIT Licensed
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):t((e=e||self).$)}(this,(function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e=e&&e.hasOwnProperty("default")?e.default:e;var o=0,a=[9,13,17,19,20,27,33,34,35,36,37,39,44,92,113,114,115,118,119,120,122,123,144,145],l=["source","empty","limit","cache","cacheExpires","focusOpen","selectFirst","changeWhenSelect","highlightMatches","ignoredKeyCode","customLabel","customValue","template","offset","combine","callback","minLength","delay"],r=window.navigator.userAgent||window.navigator.vendor||window.opera,n=/Firefox/i.test(r),c=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(r),u=n&&c,i=null,s=null,p=function(){var e=void 0!==window.localStorage;if(e)try{localStorage.setItem("autocompleter","autocompleter"),localStorage.removeItem("autocompleter")}catch(t){e=!1}return e}(),m={source:null,asLocal:!1,empty:!0,limit:10,minLength:0,delay:0,customClass:[],cache:!0,cacheExpires:86400,focusOpen:!0,hint:!1,selectFirst:!1,changeWhenSelect:!0,highlightMatches:!1,ignoredKeyCode:[],customLabel:!1,customValue:!1,template:!1,offset:!1,combine:null,callback:e.noop},d={defaults:function(o){return m=e.extend(m,o||{}),"object"!==t(this)||e(this)},option:function(t){return e(this).each((function(o,a){var r=e(a).next(".autocompleter").data("autocompleter");for(var n in t)-1!==e.inArray(n,l)&&(r[n]=t[n])}))},open:function(){return e(this).each((function(t,o){var a=e(o).next(".autocompleter").data("autocompleter");a&&j(null,a)}))},close:function(){return e(this).each((function(t,o){var a=e(o).next(".autocompleter").data("autocompleter");a&&L(null,a)}))},clearCache:function(){O()},destroy:function(){return e(this).each((function(t,o){var a=e(o).next(".autocompleter").data("autocompleter");a&&(a.jqxhr&&a.jqxhr.abort(),a.$autocompleter.hasClass("open")&&a.$autocompleter.find(".autocompleter-selected").trigger("click.autocompleter"),a.originalAutocomplete?a.$node.attr("autocomplete",a.originalAutocomplete):a.$node.removeAttr("autocomplete"),a.$node.off(".autocompleter").removeClass("autocompleter-node"),a.$autocompleter.off(".autocompleter").remove())}))}};function f(t){t=e.extend({},m,t||{}),null===i&&(i=e("body"));for(var o=e(this),a=0,l=o.length;a<l;a++)h(o.eq(a),t);return o}function h(t,a){if(!t.hasClass("autocompleter-node")){"string"!=typeof(a=e.extend({},a,t.data("autocompleter-options"))).source||".json"!==a.source.slice(-5)&&!0!==a.asLocal||e.ajax({url:a.source,type:"GET",dataType:"json",async:!1}).done((function(e){a.source=e}));var l='<div class="autocompleter '+a.customClass.join(" ")+'" id="autocompleter-'+(o+1)+'">';a.hint&&(l+='<div class="autocompleter-hint"></div>'),l+='<ul class="autocompleter-list"></ul>',l+="</div>",t.addClass("autocompleter-node").after(l);var r=t.next(".autocompleter").eq(0),n=t.attr("autocomplete");t.attr("autocomplete","off");var c=e.extend({$node:t,$autocompleter:r,$selected:null,$list:null,index:-1,hintText:!1,source:!1,jqxhr:!1,response:null,focused:!1,query:"",originalAutocomplete:n,guid:o++},a);c.$autocompleter.on("mousedown.autocompleter",".autocompleter-item",c,k).data("autocompleter",c),c.$node.on("keyup.autocompleter",c,b).on("keydown.autocompleter",c,w).on("focus.autocompleter",c,x).on("blur.autocompleter",c,C).on("mousedown.autocompleter",c,q)}}function y(t){clearTimeout(s),t.query=e.trim(t.$node.val()),!t.empty&&0===t.query.length||t.minLength&&t.query.length<t.minLength?$(t):t.delay?s=setTimeout((function(){v(t)}),t.delay):v(t)}function v(o){if("object"===t(o.source)){$(o);var a=function(e,t,o){var a=[];if(e=e.toUpperCase(),t.length)for(var l=0;l<2;l++)for(var r in t)if(a.length<o.limit){var n=o.customLabel&&t[r][o.customLabel]?t[r][o.customLabel]:t[r].label;switch(l){case 0:0===n.toUpperCase().search(e)&&(a.push(t[r]),delete t[r]);break;case 1:-1!==n.toUpperCase().search(e)&&(a.push(t[r]),delete t[r])}}return a}(o.query,function(e){var o;if(null===e||"object"!==t(e))return e;for(var a in o=e.constructor(),e)Object.prototype.hasOwnProperty.call(e,a)&&(o[a]=e[a]);return o}(o.source),o);a.length&&g(a,o)}else{o.jqxhr&&o.jqxhr.abort();var l={limit:o.limit,query:o.query};"function"==typeof o.combine&&(l=o.combine(l)),o.jqxhr=e.ajax({url:o.source,dataType:"json",crossDomain:!0,data:l,beforeSend:function(e){if(o.$autocompleter.addClass("autocompleter-ajax"),$(o),o.cache){var t=function(e,t){var o,a=!1;if(t=t||!1,!e)return!1;return!(!(o=P[e])||!o.value)&&(a=o.value,!(o.timestamp&&t&&+new Date-o.timestamp>1e3*t)&&a)}(this.url,o.cacheExpires);t&&(e.abort(),g(t,o))}}}).done((function(e){o.offset&&(e=function(e,t){t=t.split(".");for(;e&&t.length;)e=e[t.shift()];return e}(e,o.offset)),o.cache&&function(e,t){if(!p)return;if(e&&t){P[e]={value:t,timestamp:+new Date};try{localStorage.setItem("autocompleterCache",JSON.stringify(P))}catch(e){if(22!==(e.code||e.number||e.message))throw e;O()}}}(this.url,e),g(e,o)})).always((function(){o.$autocompleter.removeClass("autocompleter-ajax")}))}}function $(e){e.response=null,e.$list=null,e.$selected=null,e.index=0,e.$autocompleter.find(".autocompleter-list").empty(),e.$autocompleter.find(".autocompleter-hint").removeClass("autocompleter-hint-show").empty(),e.hintText=!1,L(null,e)}function g(t,o){!function(t,o){for(var a="",l=0,r=t.length;l<r;l++){var n=["autocompleter-item"],c=new RegExp(o.query,"gi");o.selectFirst&&0===l&&!o.changeWhenSelect&&n.push("autocompleter-item-selected");var u=o.customLabel&&t[l][o.customLabel]?t[l][o.customLabel]:t[l].label,i=u;u=o.highlightMatches?u.replace(c,"<strong>$&</strong>"):u;var s=o.customValue&&t[l][o.customValue]?t[l][o.customValue]:t[l].value;if(o.template){var p=o.template.replace(/({{ label }})/gi,u);for(var m in t[l])if(Object.prototype.hasOwnProperty.call(t[l],m)){var d=new RegExp("{{ "+m+" }}","gi");p=p.replace(d,t[l][m])}u=p}a+=s?'<li data-value="'+s+'" data-label="'+i+'" class="'+n.join(" ")+'">'+u+"</li>":'<li data-label="'+i+'" class="'+n.join(" ")+'">'+u+"</li>"}if(t.length&&o.hint){var f=o.customLabel&&t[0][o.customLabel]?t[0][o.customLabel]:t[0].label,h=f.substr(0,o.query.length).toUpperCase()===o.query.toUpperCase()&&f;if(h&&o.query!==f){var y=new RegExp(o.query,"i"),v=h.replace(y,"<span>"+o.query+"</span>");o.$autocompleter.find(".autocompleter-hint").addClass("autocompleter-hint-show").html(v),o.hintText=v}}o.response=t,o.$autocompleter.find(".autocompleter-list").html(a),o.$selected=o.$autocompleter.find(".autocompleter-item-selected").length?o.$autocompleter.find(".autocompleter-item-selected"):null,o.$list=t.length?o.$autocompleter.find(".autocompleter-item"):null,o.index=o.$selected?o.$list.index(o.$selected):-1,o.$autocompleter.find(".autocompleter-item").each((function(t,a){e(a).data(o.response[t])}))}(t,o),o.$autocompleter.hasClass("autocompleter-focus")&&j(null,o)}function b(t){var o=t.data,l=t.keyCode?t.keyCode:t.which;if(40!==l&&38!==l||!o.$autocompleter.hasClass("autocompleter-show"))-1===e.inArray(l,a)&&-1===e.inArray(l,o.ignoredKeyCode)&&y(o);else{var r,n,c=o.$list.length;c&&(c>1?o.index===c-1?(r=o.changeWhenSelect?-1:0,n=o.index-1):0===o.index?(r=o.index+1,n=o.changeWhenSelect?-1:c-1):-1===o.index?(r=0,n=c-1):(r=o.index+1,n=o.index-1):-1===o.index?(r=0,n=0):(n=-1,r=-1),o.index=40===l?r:n,o.$list.removeClass("autocompleter-item-selected"),-1!==o.index&&o.$list.eq(o.index).addClass("autocompleter-item-selected"),o.$selected=o.$autocompleter.find(".autocompleter-item-selected").length?o.$autocompleter.find(".autocompleter-item-selected"):null,o.changeWhenSelect&&E(o))}}function w(e){var t=e.data,o=e.keyCode?e.keyCode:e.which;if(40===o||38===o)e.preventDefault(),e.stopPropagation();else if(39===o){if(t.hint&&t.hintText&&t.$autocompleter.find(".autocompleter-hint").hasClass("autocompleter-hint-show")){e.preventDefault(),e.stopPropagation();var a=!!t.$autocompleter.find(".autocompleter-item").length&&t.$autocompleter.find(".autocompleter-item").eq(0).attr("data-label");a&&(t.query=a,function(e){E(e),A(e),y(e)}(t))}}else 13===o&&t.$autocompleter.hasClass("autocompleter-show")&&t.$selected&&k(e)}function x(e,t){if(!t){var o=e.data;o.$autocompleter.addClass("autocompleter-focus"),o.$node.prop("disabled")||o.$autocompleter.hasClass("autocompleter-show")||o.focusOpen&&(y(o),o.focused=!0,setTimeout((function(){o.focused=!1}),500))}}function C(e,t){e.preventDefault(),e.stopPropagation();var o=e.data;t||(o.$autocompleter.removeClass("autocompleter-focus"),L(e))}function q(t){if("mousedown"!==t.type||-1===e.inArray(t.which,[2,3])){var o=t.data;if(o.$list&&!o.focused&&!o.$node.is(":disabled"))if(c&&!u){var a=o.$select[0];if(window.document.createEvent){var l=window.document.createEvent("MouseEvents");l.initMouseEvent("mousedown",!1,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(l)}else a.fireEvent&&a.fireEvent("onmousedown")}else o.$autocompleter.hasClass("autocompleter-closed")?j(t):o.$autocompleter.hasClass("autocompleter-show")&&L(t)}}function j(e,t){var o=e?e.data:t;!o.$node.prop("disabled")&&!o.$autocompleter.hasClass("autocompleter-show")&&o.$list&&o.$list.length&&(o.$autocompleter.removeClass("autocompleter-closed").addClass("autocompleter-show"),i.on("click.autocompleter-"+o.guid,":not(.autocompleter-item)",o,S))}function S(t){e(t.target).hasClass("autocompleter-node")||0===e(t.currentTarget).parents(".autocompleter").length&&L(t)}function L(e,t){var o=e?e.data:t;o.$autocompleter.hasClass("autocompleter-show")&&(o.$autocompleter.removeClass("autocompleter-show").addClass("autocompleter-closed"),i.off(".autocompleter-"+o.guid))}function k(t){if("mousedown"!==t.type||-1===e.inArray(t.which,[2,3])){var o=t.data;t.preventDefault(),t.stopPropagation(),"mousedown"===t.type&&e(this).length&&(o.$selected=e(this),o.index=o.$list.index(o.$selected)),o.$node.prop("disabled")||(L(t),function(e){E(e),A(e),$(e)}(o),"click"===t.type&&o.$node.trigger("focus",[!0]))}}function E(e){e.$selected?(e.hintText&&e.$autocompleter.find(".autocompleter-hint").hasClass("autocompleter-hint-show")&&e.$autocompleter.find(".autocompleter-hint").removeClass("autocompleter-hint-show"),e.$node.val(e.$selected.attr("data-value")?e.$selected.attr("data-value"):e.$selected.attr("data-label"))):(e.hintText&&!e.$autocompleter.find(".autocompleter-hint").hasClass("autocompleter-hint-show")&&e.$autocompleter.find(".autocompleter-hint").addClass("autocompleter-hint-show"),e.$node.val(e.query))}function A(e){e.callback.call(e.$autocompleter,e.$node.val(),e.index,e.response[e.index]),e.$node.trigger("change")}function T(){if(p)return JSON.parse(localStorage.getItem("autocompleterCache")||"{}")}function O(){try{localStorage.removeItem("autocompleterCache"),P=T()}catch(e){}}var P=T();e.fn.autocompleter=function(e){return d[e]?d[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==t(e)&&e?this:f.apply(this,arguments)},e.autocompleter=function(e){"defaults"===e?d.defaults.apply(this,Array.prototype.slice.call(arguments,1)):"clearCache"===e&&d.clearCache.apply(this,null)}}));
